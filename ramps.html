<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Illinois: RAMPS Dashboard</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Google Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
        }

        /* Hide content sections by default */
        main section:not(.active) {
            display: none;
        }

        /* Card hover effect */
        .card-hover {
            transition: all 0.3s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Fade-in animation classes */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        .fade-in-delay-1 { transition-delay: 0.1s; }
        .fade-in-delay-2 { transition-delay: 0.2s; }
        .fade-in-delay-3 { transition-delay: 0.3s; }
        .fade-in-delay-4 { transition-delay: 0.4s; }
        .fade-in-delay-5 { transition-delay: 0.5s; }

        /* Tooltip (for new bar chart) */
        #chart-tooltip {
            position: absolute;
            opacity: 0;
            background-color: #111827; /* bg-gray-900 */
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            pointer-events: none;
            transition: opacity 0.2s;
            white-space: nowrap;
        }

        /* D3 Chart Text */
        .d3-chart text {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            fill: #4b5563; /* text-gray-600 */
        }
        .d3-chart .domain {
            stroke: #d1d5db; /* border-gray-300 */
        }
        .d3-chart .tick line {
            stroke: #e5e7eb; /* border-gray-200 */
        }

        /* Growth Bar Animation */
        .growth-bar-fill {
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 1.5s cubic-bezier(0.25, 1, 0.5, 1);
        }

        /* Custom list styles for report content */
        .content-card ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            line-height: 1.75;
        }
        .content-card li {
            margin-bottom: 0.5rem;
        }
        .content-card h3 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700; /* font-bold */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 0.5rem; /* mb-2 */
            color: #1e3a8a; /* text-blue-900 */
        }
        .content-card h4 {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            margin-top: 1rem; /* mt-4 */
            margin-bottom: 0.5rem; /* mb-2 */
            color: #1e40af; /* text-blue-800 */
        }

        /* Print-specific styles */
        @media print {
            /* Reset layout constraints */
            html, body {
                display: block !important;
                height: auto !important;
                overflow: visible !important;
                background-color: #ffffff !important;
                position: static !important;
            }
            
            body,
            body > div.flex { /* Target the main flex container */
                display: block !important;
                min-height: auto !important;
                height: auto !important;
                overflow: visible !important;
                position: static !important;
            }

            body {
                font-family: 'Times New Roman', serif; /* Classic report font */
                -webkit-print-color-adjust: exact; /* Ensures colors print */
                print-color-adjust: exact;
            }

            /* Hide all interactive elements, nav, and modals */
            nav, #modal-backdrop, #chart-tooltip, .kpi-card, .d3-chart, 
            #growth-chart-container, #report-controls {
                display: none !important;
            }

            main {
                display: block !important; /* Force block layout */
                flex: none !important; /* Disable flex */
                overflow: visible !important; /* Show all content */
                height: auto !important; /* Reset height */
                min-height: auto !important; /* Reset height */
                margin-left: 0 !important;
                width: 100% !important;
                position: static !important;
            }

            main > div {
                display: block !important; /* Disable flex */
                padding: 1in !important; /* Standard 1-inch margins */
                margin: 0 !important;
                position: static !important;
            }

            header {
                text-align: center; /* Center the main title */
                margin-bottom: 2rem !important;
            }

            header h1 {
                font-size: 24pt !important;
                color: #000000 !important;
            }
            header p {
                font-size: 16pt !important;
                color: #000000 !important;
            }

            /* Show all sections and stack them */
            main section,
            main section:not(.active) { /* <-- This selector is now more specific */
                display: block !important;
                /* page-break-before: always; -- REMOVED this rule to prevent content clipping */
                box-shadow: none !important;
                border: none !important;
                background-color: #ffffff !important;
                padding: 0 !important;
                margin-top: 0 !important; /* <-- Prevents blank pages */
            }

            /* This rule is no longer needed as page-break is removed */
            /*
            main section:first-of-type {
                page-break-before: auto;
                margin-top: 0;
            }
            */

            .content-card {
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important;
            }

            /* Add space between stacked sections */
            .content-card + .content-card {
                margin-top: 2rem !important;
            }

            /* Report-like headings */
            .content-card h2 {
                font-size: 20pt;
                color: #000000;
                border-bottom: 2px solid #000;
                padding-bottom: 8px;
                margin-top: 0;
            }
            .content-card h3 {
                font-size: 16pt;
                color: #000000;
            }
            .content-card h4 {
                font-size: 14pt;
                color: #000000;
            }
            
            p, li, td, th {
                font-size: 12pt;
                line-height: 1.5;
                color: #000000;
            }

            table {
                font-size: 11pt;
                width: 100%;
                border-collapse: collapse;
            }
            tr {
                border-bottom: 1px solid #cccccc;
            }
            td, th {
                padding: 8px 4px;
            }
            .overflow-x-auto {
                overflow-x: visible;
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Full-screen Modal -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl p-6 relative" onclick="event.stopPropagation()">
            <button id="modal-close-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <h2 id="modal-title" class="text-2xl font-bold text-slate-900 mb-4">KPI Details</h2>
            <div id="modal-chart" class="d3-chart w-full h-72"></div>
        </div>
    </div>

    <!-- Chart Tooltip -->
    <div id="chart-tooltip"></div>

    <!-- Main Layout -->
    <div class="flex flex-col md:flex-row min-h-screen">
        
        <!-- Left Navigation -->
        <nav class="md:w-64 bg-slate-900 text-slate-200 p-6 md:p-10 md:fixed md:h-full overflow-y-auto">
            <!-- Logo Header Removed -->
            
            <!-- Spacer div to align menu with content cards -->
            <div class="h-32 hidden md:block"></div> 

            <ul id="main-nav" class="space-y-2">
                <li>
                    <a href="#" class="flex items-center py-2.5 px-4 rounded-lg font-medium bg-blue-600 text-white" data-target="overview">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                        RAMPS Overview
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center py-2.5 px-4 rounded-lg font-medium text-slate-300 hover:bg-slate-800 hover:text-white" data-target="team">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                        Leadership Team
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center py-2.5 px-4 rounded-lg font-medium text-slate-300 hover:bg-slate-800 hover:text-white" data-target="goals">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                        Project Goals
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center py-2.5 px-4 rounded-lg font-medium text-slate-300 hover:bg-slate-800 hover:text-white" data-target="dashboard">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                        Year 1 Accomplishments
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center py-2.5 px-4 rounded-lg font-medium text-slate-300 hover:bg-slate-800 hover:text-white" data-target="highlights">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                        Special Highlights
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center py-2.5 px-4 rounded-lg font-medium text-slate-300 hover:bg-slate-800 hover:text-white" data-target="plan">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                        Year 2 Plan & Challenges
                    </a>
                </li>
                <li>
                    <a href="#" class="flex items-center py-2.5 px-4 rounded-lg font-medium text-slate-300 hover:bg-slate-800 hover:text-white" data-target="conclusion">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><path d="M15 12H3"></path></svg>
                        Conclusion
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 md:ml-64">
            <div class="p-6 md:p-10">
                <!-- Header -->
                <header>
                    <div id="report-controls" class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                        <div>
                            <h1 class="text-4xl font-bold text-slate-900">Cyber Illinois: RAMPS</h1>
                            <p id="report-subtitle" class="text-xl text-slate-600 mt-1">Annual Report (2024-2025)</p>
                        </div>
                        <div class="flex flex-wrap items-center gap-2 mt-4 sm:mt-0">
                            <select id="report-select" class="bg-white border border-slate-300 rounded-md shadow-sm py-2 px-3 text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option>Annual Report</option>
                                <option>Current Report</option>
                                <option>Semi-Annual Report</option>
                                <option>Final Report</option>
                            </select>
                            <button id="print-pdf-btn" class="bg-blue-600 text-white font-medium py-2 px-4 rounded-md flex items-center space-x-2 hover:bg-blue-700 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                                <span>Print PDF</span>
                            </button>
                        </div>
                    </div>
                </header>

                <!-- Section 1: RAMPS Overview -->
                <section id="overview" class="active space-y-8">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in content-card">
                        <h2 class="text-2xl font-bold mb-4">Project Details</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <tbody id="project-details-table">
                                    <!-- Project details will be injected here by JS -->
                                    <tr class="border-b">
                                        <td class="py-2 pr-4 font-semibold">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in fade-in-delay-1 content-card">
                        <h2 class="text-2xl font-bold mb-4">Executive Summary</h2>
                        <div id="executive-summary-content" class="space-y-4">
                            <p class="text-lg text-slate-700 leading-relaxed">Loading executive summary...</p>
                        </div>
                    </div>
                </section>

                <!-- Section 2: Leadership Team -->
                <section id="team" class="space-y-8">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in content-card">
                        <h2 class="text-2xl font-bold mb-4">Project Leadership Team</h2>
                        <p id="team-intro" class="text-lg text-slate-700 leading-relaxed">
                            Loading team introduction...
                        </p>
                        <div id="team-members-list">
                            <!-- Team members will be injected here by JS -->
                        </div>
                    </div>
                </section>

                <!-- Section 3: Project Goals -->
                <section id="goals" class="space-y-8">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in content-card">
                        <h2 class="text-2xl font-bold mb-4">Project Goals and Objectives</h2>
                        <p id="goals-intro" class="text-lg text-slate-700 leading-relaxed">
                            Loading project goals...
                        </p>
                        <div id="project-goals-list">
                            <!-- Project goals will be injected here by JS -->
                        </div>
                    </div>
                </section>

                <!-- Section 4: Year 1 Accomplishments -->
                <section id="dashboard" class="space-y-8">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in content-card">
                        <h2 class="text-2xl font-bold mb-4">Year One Summary</h2>
                        <p id="y1-summary-intro" class="text-lg text-slate-700 leading-relaxed">
                            Loading Year 1 summary...
                        </p>
                        <div id="y1-summary-events">
                            <!-- Year 1 summary events will be injected here by JS -->
                        </div>
                    </div>
                    
                    <!-- KPI Grid -->
                    <div id="kpi-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- KPIs will be injected here by JS -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200"><p>Loading KPIs...</p></div>
                    </div>

                    <!-- Sector Chart & Growth Chart -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-200 fade-in fade-in-delay-2">
                            <h3 class="text-xl font-bold mb-4">Advisory Engagement by Sector</h3>
                            <div id="sector-chart-container" class="d3-chart w-full h-96"></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 fade-in fade-in-delay-3">
                            <h3 class="text-xl font-bold mb-4">Top Certification Focus</h3>
                            <div id="growth-chart-container" class="space-y-4">
                                <!-- Certification focus bars will be injected here by JS -->
                                <p>Loading chart...</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in fade-in-delay-4 content-card">
                        <h2 class="text-2xl font-bold mb-4">Accomplishments Under Project Goals</h2>
                        <div id="accomplishments-by-goal-list">
                            <!-- Accomplishments by goal will be injected here by JS -->
                        </div>
                    </div>
                </section>

                <!-- Section 5: Special Highlights -->
                <section id="highlights" class="space-y-8">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in content-card">
                        <h2 class="text-2xl font-bold mb-4">Special Highlights: Professional Development and Training</h2>
                        <p id="training-intro" class="text-lg text-slate-700 leading-relaxed">
                            Loading training highlights...
                        </p>
                        <div id="training-initiatives-list">
                            <!-- Training initiatives will be injected here by JS -->
                        </div>
                    </div>

                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in fade-in-delay-1 content-card">
                        <h2 class="text-2xl font-bold mb-4">Special Highlights: Strategic Partnership (NCYTE)</h2>
                        <p id="partnership-intro" class="text-lg text-slate-700 leading-relaxed">
                            Loading partnership highlights...
                        </p>
                        <div id="partnership-sections-list">
                            <!-- Partnership sections will be injected here by JS -->
                        </div>
                    </div>
                </section>

                <!-- Section 6: Year 2 Plan & Challenges -->
                <section id="plan" class="space-y-8">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in content-card">
                        <h2 class="text-2xl font-bold mb-4">Plans for the Next Reporting Period (Year 2)</h2>
                        <p id="y2-plan-intro" class="text-lg text-slate-700 leading-relaxed">
                            Loading Year 2 plan...
                        </p>
                        <div id="y2-plan-list">
                            <!-- Year 2 plans will be injected here by JS -->
                        </div>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in fade-in-delay-1 content-card">
                        <h2 class="text-2xl font-bold mb-4">Changes and Challenges</h2>
                        <div id="changes-challenges-content">
                            <!-- Changes and challenges will be injected here by JS -->
                        </div>
                    </div>
                </section>

                <!-- Section 7: Conclusion -->
                <section id="conclusion" class="space-y-8">
                     <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 fade-in content-card">
                        <h2 class="text-2xl font-bold mb-4">Conclusion</h2>
                        <div id="conclusion-content" class="space-y-4">
                            <p class="text-lg text-slate-700 leading-relaxed">Loading conclusion...</p>
                        </div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <!-- Core JavaScript Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- GLOBAL DATA STORE ---
            let reportData = {};
            let activeChartDrawers = {}; // Object to store chart drawing functions

            // --- SELECTORS ---
            const navContainer = document.getElementById('main-nav');
            const navButtons = navContainer.querySelectorAll('a');
            const contentSections = document.querySelectorAll('main > div > section');
            const modalBackdrop = document.getElementById('modal-backdrop');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalTitle = document.getElementById('modal-title');
            const chartTooltip = document.getElementById('chart-tooltip');
            const printBtn = document.getElementById('print-pdf-btn');
            const reportSelect = document.getElementById('report-select');
            
            // --- DATA POPULATION FUNCTIONS ---

            function populateProjectDetails(details) {
                const tableBody = document.getElementById('project-details-table');
                if (!tableBody || !details) return;
                tableBody.innerHTML = details.map(item => `
                    <tr class="border-b last:border-b-0">
                        <td class="py-2 pr-4 font-semibold">${item.label}</td>
                        <td class="py-2 text-slate-700">${item.value}</td>
                    </tr>
                `).join('');
            }

            function populateExecutiveSummary(summary) {
                const container = document.getElementById('executive-summary-content');
                if (!container || !summary) return;
                container.innerHTML = summary.map(p => `
                    <p class="text-lg text-slate-700 leading-relaxed">${p}</p>
                `).join('');
            }

            function populateTeam(team) {
                const intro = document.getElementById('team-intro');
                const container = document.getElementById('team-members-list');
                if (!intro || !container || !team) return;
                intro.textContent = team.introduction;
                container.innerHTML = team.members.map(member => `
                    <h3>${member.name} - ${member.title}</h3>
                    <p class="text-slate-600 leading-relaxed">${member.bio}</p>
                `).join('');
            }

            function populateGoals(goals) {
                const intro = document.getElementById('goals-intro');
                const container = document.getElementById('project-goals-list');
                if (!intro || !container || !goals) return;
                intro.textContent = goals.introduction;
                container.innerHTML = goals.goals.map(goal => `
                    <h3>${goal.title}</h3>
                    <ul>
                        ${(goal.objectives || []).map(obj => `
                            <li>
                                <strong>Objective ${obj.id}:</strong> ${obj.text}
                                <br><em>Metric: ${obj.metric}</em>
                            </li>
                        `).join('')}
                    </ul>
                `).join('');
            }

            function populateYear1Summary(summary) {
                const intro = document.getElementById('y1-summary-intro');
                const container = document.getElementById('y1-summary-events');
                if (!intro || !container || !summary) return;
                intro.textContent = summary.introduction;
                container.innerHTML = (summary.events || []).map(event => `
                    <h4>${event.title}</h4>
                    <p class="text-slate-600 leading-relaxed">${event.description}</p>
                `).join('');
            }

            function populateKPIs(kpis) {
                const container = document.getElementById('kpi-grid');
                if (!container || !kpis) return;
                container.innerHTML = kpis.map((kpi, i) => `
                    <div id="${kpi.id}" class="kpi-card bg-white p-6 rounded-xl shadow-sm border border-slate-200 card-hover cursor-pointer fade-in fade-in-delay-${i}" 
                         data-values='${JSON.stringify(kpi.modalData)}' 
                         data-title="${kpi.modalTitle}">
                        
                        <h3 class="text-base font-semibold text-slate-600">${kpi.title}</h3>
                        <div class="flex justify-between items-baseline">
                            <span class="text-4xl font-extrabold text-slate-900 kpi-value" data-target="${kpi.target}">0</span>
                            <span class="text-lg font-bold text-green-600">${kpi.growth}</span>
                        </div>
                        <p class="text-sm text-slate-500 mt-1">${kpi.description}</p>
                    </div>
                `).join('');
                
                // Re-attach event listeners to new KPI cards
                document.querySelectorAll('.kpi-card').forEach(card => card.addEventListener('click', showModal));
            }

            function populateGrowthChart(chartData) {
                const container = document.getElementById('growth-chart-container');
                if (!container || !chartData) return;
                container.innerHTML = chartData.map(bar => `
                    <div class="growth-bar">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-slate-700">${bar.name}</span>
                            <span class="text-sm font-medium text-slate-500">${bar.label}</span>
                        </div>
                        <div class="w-full bg-slate-200 rounded-full h-2.5">
                            <div class="growth-bar-fill bg-blue-600 h-2.5 rounded-full" style="width: ${bar.width};"></div>
                        </div>
                    </div>
                `).join('');
            }

            function populateAccomplishmentsByGoal(goals) {
                const container = document.getElementById('accomplishments-by-goal-list');
                if (!container || !goals) return;
                container.innerHTML = goals.map(goal => `
                    <h3>${goal.title}</h3>
                    <ul>
                        ${(goal.accomplishments || []).map(item => `<li>${item}</li>`).join('')}
                    </ul>
                `).join('');
            }

            function populateHighlightsTraining(training) {
                const intro = document.getElementById('training-intro');
                const container = document.getElementById('training-initiatives-list');
                if (!intro || !container || !training) return;
                intro.textContent = training.introduction;
                container.innerHTML = (training.initiatives || []).map(item => `
                    <h3>${item.title}</h3>
                    <p class="text-slate-600 leading-relaxed"><strong>${item.subtitle}</strong><br>${item.description}</p>
                    ${item.detailsTitle ? `<h4>${item.detailsTitle}</h4>` : ''}
                    ${item.details ? `<ul>${(item.details || []).map(d => `<li>${d}</li>`).join('')}</ul>` : ''}
                    ${item.conclusion ? `<p class="text-slate-600 leading-relaxed">${item.conclusion}</p>` : ''}
                `).join('');
            }

            function populateHighlightsPartnership(partnership) {
                const intro = document.getElementById('partnership-intro');
                const container = document.getElementById('partnership-sections-list');
                if (!intro || !container || !partnership) return;
                intro.textContent = partnership.introduction;
                container.innerHTML = (partnership.sections || []).map(section => `
                    <h3>${section.title}</h3>
                    ${Array.isArray(section.description) ? 
                        section.description.map(p => `<p class="text-slate-600 leading-relaxed ${section.description.indexOf(p) > 0 ? 'mt-4' : ''}">${p}</p>`).join('') : 
                        `<p class="text-slate-600 leading-relaxed">${section.description || ''}</p>`
                    }
                    ${section.list ? `<ul>${(section.list || []).map(item => `<li>${item}</li>`).join('')}</ul>` : ''}
                `).join('');
            }

            function populateYear2Plan(plan) {
                const intro = document.getElementById('y2-plan-intro');
                const container = document.getElementById('y2-plan-list');
                if (!intro || !container || !plan) return;
                intro.textContent = plan.introduction;
                container.innerHTML = (plan.plans || []).map(item => `
                    <h4>${item.title}</h4>
                    <p class="text-slate-600 leading-relaxed">${item.description}</p>
                    ${item.sublist ? `<ul class="!mt-2 !ml-4">${(item.sublist || []).map(s => `<li>${s}</li>`).join('')}</ul>` : ''}
                    ${item.note ? `<p class="text-sm text-slate-600 leading-relaxed">${item.note}</p>` : ''}
                `).join('');
            }

            function populateChallenges(challenges) {
                const container = document.getElementById('changes-challenges-content');
                if (!container || !challenges) return;
                container.innerHTML = `
                    <h3>${challenges.changes.title}</h3>
                    <p class="text-slate-600 leading-relaxed">${challenges.changes.description}</p>
                    <h3 class="mt-6">${challenges.delays.title}</h3>
                    ${(challenges.delays.description || []).map(p => `<p class="text-slate-600 leading-relaxed ${challenges.delays.description.indexOf(p) > 0 ? 'mt-4' : ''}">${p}</p>`).join('')}
                `;
            }

            function populateConclusion(conclusion) {
                const container = document.getElementById('conclusion-content');
                if (!container || !conclusion) return;
                container.innerHTML = (conclusion.paragraphs || []).map(p => `
                    <p class="text-lg text-slate-700 leading-relaxed">${p}</p>
                `).join('');
            }

            function populateDashboard() {
                if (!reportData) return;

                // Populate all sections
                populateProjectDetails(reportData.projectDetails || []);
                populateExecutiveSummary(reportData.overview.executiveSummary || []);
                populateTeam(reportData.leadershipTeam || {});
                populateGoals(reportData.projectGoals || {});
                populateYear1Summary(reportData.year1Accomplishments.summary || {});
                populateKPIs(reportData.year1Accomplishments.kpis || []);
                populateGrowthChart(reportData.year1Accomplishments.charts.certificationFocus || []);
                populateAccomplishmentsByGoal(reportData.year1Accomplishments.byGoal || []);
                populateHighlightsTraining(reportData.specialHighlights.training || {});
                populateHighlightsPartnership(reportData.specialHighlights.partnership || {});
                populateYear2Plan(reportData.year2Plan || {});
                populateChallenges(reportData.challenges || {});
                populateConclusion(reportData.conclusion || {});

                // Set up chart drawing functions
                activeChartDrawers['dashboard'] = () => {
                    if (reportData.charts) {
                        drawSectorChart(reportData.charts.sectorEngagement || []);
                    }
                };
                
                // This chart was in the old EPNC 'goals' tab, but there's no div for it.
                // I'll leave this here in case you add a div with id="advisor-chart-container"
                activeChartDrawers['goals'] = () => {
                    // createAdvisorChart(reportData.charts.advisorChart || []);
                };

                // Trigger animations for the initially active section
                triggerSectionAnimations(document.querySelector('section.active'));
            }


            // --- ANIMATION OBSERVER ---
            const animationObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const el = entry.target;
                        if (el.classList.contains('pillar-counter') || el.classList.contains('kpi-value')) {
                            animateCounter(el);
                        }
                        if (el.classList.contains('growth-bar-fill')) {
                            el.style.transform = 'scaleX(1)';
                        }
                        if (el.classList.contains('fade-in')) {
                            el.classList.add('is-visible');
                        }
                        observer.unobserve(el);
                    }
                });
            }, { threshold: 0.1 });

            function triggerSectionAnimations(section) {
                if (!section) return; // Add null check
                section.querySelectorAll('.pillar-counter, .kpi-value, .growth-bar-fill, .fade-in').forEach(el => {
                    // Reset animations for re-triggering
                    if (el.classList.contains('fade-in')) {
                        el.classList.remove('is-visible');
                    }
                    if (el.classList.contains('growth-bar-fill')) {
                        // For growth bars, we let them animate once on load
                        animationObserver.observe(el);
                    } else {
                        animationObserver.observe(el);
                    }
                });
            }

            // --- NAVIGATION ---
            navContainer.addEventListener('click', (e) => {
                const clickedButton = e.target.closest('a');
                if (!clickedButton) return;
                
                e.preventDefault();
                const targetId = clickedButton.dataset.target;
                const targetSection = document.getElementById(targetId);

                // Update buttons
                navButtons.forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'text-white');
                    btn.classList.add('text-slate-300', 'hover:bg-slate-800');
                });
                clickedButton.classList.add('bg-blue-600', 'text-white');
                clickedButton.classList.remove('text-slate-300', 'hover:bg-slate-800');

                // Update content sections
                contentSections.forEach(section => {
                    section.classList.remove('active');
                });
                if (targetSection) {
                    targetSection.classList.add('active');
                    triggerSectionAnimations(targetSection);
                    
                    // Draw charts for the newly active section
                    if (activeChartDrawers[targetId]) {
                        // Use a small timeout to ensure section is visible
                        setTimeout(activeChartDrawers[targetId], 50);
                    }
                    
                    // Scroll to top of main content area on tab change
                    if (document.querySelector('main')) {
                        document.querySelector('main').scrollTop = 0;
                    }
                }
            });

            // --- MODAL LOGIC ---
            function showModal(e) {
                const card = e.currentTarget;
                const values = JSON.parse(card.dataset.values);
                const title = card.dataset.title;
                
                modalTitle.textContent = `${title} (YoY Growth)`;
                modalBackdrop.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
                createModalBarChart(values, '#modal-chart');
            }

            function hideModal() {
                modalBackdrop.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }

            // Note: KPI card listeners are now added in populateKPIs()
            modalCloseBtn.addEventListener('click', hideModal);
            modalBackdrop.addEventListener('click', (e) => {
                if (e.target === modalBackdrop) {
                    hideModal();
                }
            });
            
            // --- COUNTER ANIMATION ---
            function animateCounter(el) {
                const target = parseInt(el.dataset.target, 10);
                if (isNaN(target)) return;
                
                const duration = 1500;
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const currentValue = Math.floor(progress * target);
                    el.textContent = currentValue.toLocaleString();
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    } else {
                        el.textContent = target.toLocaleString(); // Ensure final value
                    }
                };
                window.requestAnimationFrame(step);
            }

            // --- REPORT CONTROLS ---
            function updateReportTitle(reportType) {
                const subtitle = document.getElementById('report-subtitle');
                if (!subtitle) return;
                let year = "";
                const date = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };

                switch(reportType) {
                    case 'Current Report':
                        year = ` (${date.toLocaleDateString('en-US', options)})`;
                        break;
                    case 'Semi-Annual Report':
                        year = " (April 2025)"; // Based on Oct 2025 report date
                        break;
                    case 'Annual Report':
                        year = " (2024-2025)"; // The default
                        break;
                    case 'Final Report':
                        year = " (Sept 2026)"; // Based on project period
                        break;
                }
                subtitle.textContent = `${reportType}${year}`;
            }

            printBtn.addEventListener('click', () => {
                window.print();
            });

            reportSelect.addEventListener('change', (e) => {
                updateReportTitle(e.target.value);
            });


            // --- D3 CHARTS ---

            // 1. Modal Bar Chart (for KPIs)
            function createModalBarChart(data, containerSelector) {
                const container = d3.select(containerSelector);
                if (!container.node()) return;
                container.selectAll("*").remove(); // Clear previous chart

                const margin = { top: 20, right: 20, bottom: 30, left: 50 };
                const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
                const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

                const svg = container.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                const x = d3.scaleBand()
                    .domain(data.map(d => d.year)) // "year" is used as the category label
                    .range([0, width])
                    .padding(0.4);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.value) * 1.1]) // Add 10% buffer
                    .range([height, 0]);

                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x).tickSizeOuter(0));

                svg.append("g")
                    .call(d3.axisLeft(y).ticks(5).tickFormat(d3.format("~s"))); // e.g., 100k

                svg.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d.year))
                    .attr("y", height) // Start from bottom
                    .attr("width", x.bandwidth())
                    .attr("height", 0) // Start with 0 height
                    .attr("fill", (d, i) => i === 0 ? "#60a5fa" : "#2563eb") // Lighter/darker blue
                    .attr("rx", 3) // Rounded corners
                    .transition()
                    .duration(1000)
                    .attr("y", d => y(d.value))
                    .attr("height", d => height - y(d.value));
            }

            // 2. Advisor Diverging Chart (Example, if you add the div)
            function createAdvisorChart(data) {
                const container = d3.select("#advisor-chart-container");
                if (!container.node() || !data || data.length === 0) return;
                
                const margin = { top: 10, right: 30, bottom: 20, left: 120 };
                const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
                const height = data.length * 40; // 40px per bar
                
                container.selectAll("*").remove();

                const svg = container.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);
                
                const y = d3.scaleBand()
                    .domain(data.map(d => d.category))
                    .range([0, height])
                    .padding(0.3);
                
                const x = d3.scaleLinear()
                    .domain([-60, 60]) // Centered at 0
                    .range([0, width]);

                // Y-Axis (Category Labels)
                svg.append("g")
                    .call(d3.axisLeft(y).tickSize(0))
                    .attr("class", "text-sm")
                    .select(".domain").remove();
                
                // X-Axis (Center Line)
                svg.append("g")
                    .attr("transform", `translate(${x(0)}, 0)`)
                    .call(d3.axisBottom(x).tickValues([0]).tickFormat("").tickSize(height))
                    .select(".domain").remove();

                // Pre-Training Bars (Negative)
                svg.selectAll(".bar-pre")
                    .data(data)
                    .join("rect")
                    .attr("class", "bar-pre")
                    .attr("y", d => y(d.category))
                    .attr("x", d => x(d.pre))
                    .attr("width", 0) // Start at 0
                    .attr("height", y.bandwidth())
                    .attr("fill", "#fca5a5") // red-300
                    .transition().duration(1000).delay(200)
                    .attr("width", d => x(0) - x(d.pre));

                // Post-Training Bars (Positive)
                svg.selectAll(".bar-post")
                    .data(data)
                    .join("rect")
                    .attr("class", "bar-post")
                    .attr("y", d => y(d.category))
                    .attr("x", x(0))
                    .attr("width", 0) // Start at 0
                    .attr("height", y.bandwidth())
                    .attr("fill", "#6ee7b7") // green-300
                    .transition().duration(1000).delay(200)
                    .attr("width", d => x(d.post) - x(0));
            }
            
            // 3. Sector Engagement Bar Chart (Replaced US Map)
            function drawSectorChart(data) {
                const container = d3.select("#sector-chart-container");
                if (!container.node() || !data || data.length === 0) return;
                
                container.selectAll("*").remove();

                const margin = { top: 20, right: 20, bottom: 100, left: 50 };
                const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
                const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

                const svg = container.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                const x = d3.scaleBand()
                    .domain(data.map(d => d.sector))
                    .range([0, width])
                    .padding(0.3);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.participants) * 1.1])
                    .range([height, 0]);

                // X-Axis
                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");

                // Y-Axis
                svg.append("g")
                    .call(d3.axisLeft(y).ticks(5).tickFormat(d3.format("~s")));

                // Bars
                svg.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d.sector))
                    .attr("y", height)
                    .attr("width", x.bandwidth())
                    .attr("height", 0)
                    .attr("fill", "#3b82f6") // blue-600
                    .attr("rx", 3)
                    .on("mouseover", (event, d) => {
                        chartTooltip.style("opacity", 1)
                            .html(`<strong>${d.sector}</strong><br>${d.participants} Participants`);
                    })
                    .on("mousemove", (event) => {
                        chartTooltip.style("left", (event.pageX + 15) + "px")
                                  .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", () => {
                        chartTooltip.style("opacity", 0);
                    })
                    .transition()
                    .duration(1000)
                    .delay((d, i) => i * 100)
                    .attr("y", d => y(d.participants))
                    .attr("height", d => height - y(d.participants));
            }
            
            // --- INITIALIZE APPLICATION ---
            async function initializeApp() {
                try {
                    // Fetch data from the JSON file, appending a timestamp to prevent caching
                    const response = await fetch('ramps_report_data.json?' + new Date().getTime()); 
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    reportData = await response.json();
                    
                    // Once data is loaded, populate the dashboard
                    populateDashboard();

                } catch (error) {
                    console.error("Could not load report data:", error);
                    const overviewSection = document.getElementById('overview');
                    if (overviewSection) {
                        overviewSection.innerHTML = 
                            `<div class="bg-white p-8 rounded-xl shadow-sm border border-red-300">
                                <h2 class="text-2xl font-bold text-red-700 mb-4">Error Loading Report</h2>
                                <p class="text-lg text-red-600">Could not fetch data from <code>ramps_report_data.json</code>.</p>
                                <p class="text-sm text-slate-500 mt-4">Please ensure the file exists and is in the same directory as the HTML file.</p>
                                <pre class="bg-slate-100 p-4 rounded-md text-sm mt-2">${error}</pre>
                            </div>`;
                    }
                }
            }

            initializeApp(); // Start the application

        });
    </script>

</body>
</html>

